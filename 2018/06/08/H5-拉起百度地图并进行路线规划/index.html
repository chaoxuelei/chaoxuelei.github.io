<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Joshua"><title>H5 拉起百度地图并进行路线规划 · Joshua-blog_晁学磊</title><meta name="description" content="这几天在研究app分享页的定位怎样能拉起百度地图去进行路径规划，不拉起来也行，打开百度地图网页版事情也能解决，在网上找了一通，功夫不负有心人，找到了这个方法。对此进行了一些优化。

本文示例，在H5中调用百度地图的js api,根据经纬度显示地图，同时可点击打开百度地图的APP，将当前定位传到APP"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="main"><div class="page-top animated fadeInDown"><div class="main"><div class="sidebar animated fadeInDown"><div class="logo-title"><a href="/"><img src="/images/logo@2x.png" style="height:40px;"></a></div></div><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="cont-right"><div class="post-title"><h3><h2 style="text-align: center;">H5 拉起百度地图并进行路线规划</h2></h3></div><div class="post-content"><blockquote>
<p>这几天在研究app分享页的定位怎样能拉起百度地图去进行路径规划，不拉起来也行，打开百度地图网页版事情也能解决，在网上找了一通，功夫不负有心人，找到了这个方法。<br>对此进行了一些优化。</p>
</blockquote>
<p>本文示例，在H5中调用百度地图的js api,根据经纬度显示地图，同时可点击打开百度地图的APP，将当前定位传到APP中，实现路径规划。注意安卓和苹果的，调起APP的时候协议是不同的。</p>
<p>被拉起页面的跳转链接<br>后面把目的地位置坐标带上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx.com/baiduMap.html?108.2555555555_34.25656565565</span><br></pre></td></tr></table></figure>

<p>被拉起页面的代码<br>获取<code>108.2555555555_34.25656565565</code>的方法这里就不写了，或取URL参数的方式网上搜一下就行，获取后覆盖下面代码里面的x、y坐标就行。</p>
<p><code>baiduMap.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://api.map.baidu.com/api?v=2.0&amp;ak=你的密钥"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">        #allmap</span><br><span class="line">        &#123;</span><br><span class="line">            position:absolute;</span><br><span class="line">            width: 100%;</span><br><span class="line">            height: 100%;</span><br><span class="line">            margin: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        var scheme = "";</span><br><span class="line">        $(function () &#123;</span><br><span class="line">            var map = new BMap.Map("allmap");</span><br><span class="line">            map.centerAndZoom(new BMap.Point(116.331398, 39.897445), 11); //经纬度</span><br><span class="line">            map.enableScrollWheelZoom(true);</span><br><span class="line"> </span><br><span class="line">            map.clearOverlays();</span><br><span class="line">            var new_point = new BMap.Point(Number('@ViewBag.Longitude'), Number('@ViewBag.Latitude'));</span><br><span class="line">            var marker = new BMap.Marker(new_point);  // 创建标注</span><br><span class="line">            map.addOverlay(marker);              // 将标注添加到地图中</span><br><span class="line">            map.panTo(new_point);</span><br><span class="line">            map.setZoom(18);</span><br><span class="line">            map.addControl(new BMap.ScaleControl(&#123; anchor: BMAP_ANCHOR_BOTTOM_LEFT, offset: &#123; height: 30, width: 5 &#125; &#125;));// 左下角，添加比例尺</span><br><span class="line"> </span><br><span class="line">            var cr = new BMap.CopyrightControl(&#123; anchor: BMAP_ANCHOR_BOTTOM_RIGHT, offset: &#123; height: 30, width: 5 &#125; &#125;);   //设置版权控件位置</span><br><span class="line">            map.addControl(cr); //添加版权控件</span><br><span class="line"><span class="xml">            cr.addCopyright(&#123; id: 1, content: "<span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">'OpenApp()'</span> <span class="attr">href</span>=<span class="string">'#'</span> <span class="attr">style</span>=<span class="string">'font-size: 16px;background: #ebedf0;border: solid 1px #606366;border-radius: 4px;padding: 2px;color: #606366;text-decoration: none;'</span>&gt;</span>打开百度地图<span class="tag">&lt;/<span class="name">a</span>&gt;</span>" &#125;);</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        function OpenApp() &#123;</span><br><span class="line">            var geolocation = new BMap.Geolocation();</span><br><span class="line">            geolocation.getCurrentPosition(function (r) &#123;</span><br><span class="line">                if (this.getStatus() == BMAP_STATUS_SUCCESS) &#123;</span><br><span class="line">                    if (r.point.lat != "" &amp;&amp; r.point.lng != "") &#123;</span><br><span class="line">                        scheme = "://map/direction?origin=latlng:" + r.point.lat + "," + r.point.lng + "|name:我的位置&amp;destination=latlng:@ViewBag.Latitude,@ViewBag.Longitude|name:@ViewBag.Address&amp;mode=driving";</span><br><span class="line"> </span><br><span class="line">                        var I = navigator.userAgent;</span><br><span class="line">                        var isiPad = (I.match(/(iPad).*OS\s([\d_]+)/)) ? true : false;</span><br><span class="line">                        var isAndroid = I.match(/android/i) ? true : false;</span><br><span class="line">                        var isMac = (I.match(/(Mac\sOS)\sX\s([\d_]+)/)) ? true : false;</span><br><span class="line">                        var isiPhone = (!isiPad &amp;&amp; I.match(/(iPhone\sOS)\s([\d_]+)/)) ? true : false;</span><br><span class="line">                        var isSafari = (isiPhone || isiPad) &amp;&amp; I.match(/Safari/);</span><br><span class="line">                        var isMQQBrowser = I.match(/MQQBrowser\/([\d\.]+)/) ? true : false;</span><br><span class="line">                        var isUCBrowser = I.match(/UCBrowser\/([\d\.]+)/) ? true : false;</span><br><span class="line">                        var isQQ = (!isMQQBrowser) ? (I.match(/QQ\/([\d\.]+)/) ? true : false) : false;</span><br><span class="line">                        var safariVersion = 0;</span><br><span class="line">                        isSafari &amp;&amp; (safariVersion = I.match(/Version\/([\d\.]+)/));</span><br><span class="line">                        try &#123; safariVersion = parseFloat(safariVersion[1], 10) &#125; catch (R) &#123; &#125;</span><br><span class="line">                        var isSAMSUNG = I.toUpperCase().indexOf("SAMSUNG-SM-N7508V") != -1;</span><br><span class="line">                        // 尝试打开手机APP  </span><br><span class="line">                        if ((isSafari &amp;&amp; safariVersion &gt;= 9) || isMac || isSAMSUNG || isUCBrowser || isMQQBrowser || isQQ || isiPhone) &#123;</span><br><span class="line">                            tryIOpen(scheme);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            tryAOpen(scheme);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        alert("无法获取当前位置!");</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    alert("无法获取当前位置!");</span><br><span class="line">                    console('无法获取当前位置' + this.getStatus());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123; enableHighAccuracy: true, timeout: 1000 &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        function tryAOpen(scheme) &#123;</span><br><span class="line">            var protocol = "bdapp";</span><br><span class="line">            var iframe = document.createElement("iframe");</span><br><span class="line">            iframe.Id = "i" + Math.random().toString().replace(".", "");</span><br><span class="line">            iframe.src = protocol+scheme;</span><br><span class="line">            iframe.style.display = "none";</span><br><span class="line">            document.body.appendChild(iframe);</span><br><span class="line">            setTimeout(function () &#123;</span><br><span class="line">                document.body.removeChild(iframe);</span><br><span class="line">            &#125;, 500)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        function tryIOpen(scheme) &#123;</span><br><span class="line">            var protocol = "baidumap";</span><br><span class="line">            var a = document.createElement("a");</span><br><span class="line">            a.id = "a" + Math.random().toString().replace(".", "");</span><br><span class="line">            a.href = protocol + scheme ;</span><br><span class="line">            document.body.appendChild(a);</span><br><span class="line">            var T = document.createEvent("HTMLEvents");</span><br><span class="line">            T.initEvent("click", !1, !1),</span><br><span class="line">            a.dispatchEvent(T)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"allmap"</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/gis/" title="gis">gis </a></div></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://chaoxuelei.github.io/2018/06/08/H5-拉起百度地图并进行路线规划/,Joshua-blog_晁学磊,H5 拉起百度地图并进行路线规划,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/09/08/非常好的网站和技巧合集【持续更新】/" title="非常好的网站和技巧合集【持续更新】">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/03/08/hello-world/" title="WRITE HEXO BLOG WIKI">下一篇</a></li></ul></div></div></div></div><div class="footer"><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>